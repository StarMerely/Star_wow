# 安装和配置指南

## 📦 安装步骤

### 方法 1: 使用构建脚本（推荐）

```bash
# 1. 进入项目目录
cd /Users/star/Desktop/ZYBProduct/other/Star_wow

# 2. 运行构建脚本
./build.sh

# 3. 应用会自动复制到桌面
```

### 方法 2: 使用 Xcode

1. 打开 `MacWoWAuxiliary.xcodeproj`
2. 选择 `Product` → `Build`
3. 选择 `Product` → `Archive`
4. 导出应用到指定位置

---

## 🔐 权限配置

### 必需权限清单

| 权限类型 | 用途 | 配置路径 |
|---------|------|---------|
| **辅助功能** | 键盘输入、鼠标点击 | 系统设置 → 隐私与安全性 → 辅助功能 |
| **屏幕录制** | OCR 截屏识别 | 系统设置 → 隐私与安全性 → 屏幕录制 |

### 详细配置步骤

#### 步骤 1: 授予辅助功能权限

1. 打开 **系统设置** (System Settings)
2. 点击 **隐私与安全性** (Privacy & Security)
3. 点击 **辅助功能** (Accessibility)
4. 点击左下角的 **🔒** 解锁（需要输入密码）
5. 点击 **+** 按钮
6. 找到并选择 `MacWoWAuxiliary.app`
7. 确保应用旁边的复选框被勾选 ✅

#### 步骤 2: 授予屏幕录制权限

1. 打开 **系统设置** (System Settings)
2. 点击 **隐私与安全性** (Privacy & Security)
3. 点击 **屏幕录制** (Screen Recording)
4. 点击左下角的 **🔒** 解锁（需要输入密码）
5. 找到 `MacWoWAuxiliary` 并勾选 ✅

#### 步骤 3: 重启应用

⚠️ **重要**: 授予权限后必须重启应用才能生效！

---

## 🚀 首次运行

### 1. 打开应用

双击 `MacWoWAuxiliary.app` 启动应用

### 2. 如果遇到安全提示

如果 macOS 提示"无法打开应用，因为它来自身份不明的开发者"：

#### 方法 A: 通过系统设置打开

1. 右键点击应用
2. 选择 **打开**
3. 在弹出的对话框中点击 **打开**

#### 方法 B: 使用终端命令

```bash
# 移除隔离属性
xattr -cr ~/Desktop/MacWoWAuxiliary.app

# 或者指定完整路径
xattr -cr /Applications/MacWoWAuxiliary.app
```

### 3. 验证权限

首次运行时，应用会请求必要的权限：

- ✅ 辅助功能权限 - 用于键盘输入和鼠标点击
- ✅ 屏幕录制权限 - 用于 OCR 功能

如果没有弹出权限请求，请手动按照上述步骤配置。

---

## 🧪 功能测试

### 测试键盘输入功能

1. 切换到 **"键盘输入"** 标签页
2. 设置定时时间为 `0.1` 分钟（6 秒）
3. 输入按键序列 `abc`
4. 打开一个文本编辑器（如 TextEdit）
5. 点击 **"开始"** 按钮
6. 观察是否在 6 秒后自动输入 `abc`

### 测试 OCR 功能

1. 切换到 **"OCR识别"** 标签页
2. 设置扫描间隔为 `1` 秒
3. 点击 **"开始扫描"**
4. 观察是否显示识别到的文字
5. 在查找框输入屏幕上可见的文字（如 "OCR识别"）
6. 点击 **"查找并点击"**
7. 观察鼠标是否自动移动并点击

---

## ⚙️ 配置建议

### 键盘输入功能

| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 定时间隔 | 15-30 分钟 | 避免过于频繁 |
| 按键序列 | 根据需求 | 支持字母、数字、space |

### OCR 功能

| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 扫描间隔 | 1-2 秒 | 平衡性能和响应速度 |
| 查找文字 | 完整文字 | 提高匹配准确度 |

---

## 🔧 故障排除

### 问题 1: 无法打开应用

**症状**: 双击应用无反应或提示错误

**解决方案**:
```bash
# 检查应用是否存在
ls -la ~/Desktop/MacWoWAuxiliary.app

# 移除隔离属性
xattr -cr ~/Desktop/MacWoWAuxiliary.app

# 检查权限
ls -la ~/Desktop/MacWoWAuxiliary.app/Contents/MacOS/MacWoWAuxiliary
```

### 问题 2: 键盘输入不工作

**症状**: 点击开始后没有键盘输入

**解决方案**:
1. 检查是否授予了辅助功能权限
2. 在系统设置中确认应用已被勾选
3. 重启应用
4. 确保目标应用在前台

### 问题 3: OCR 无法截屏

**症状**: 点击开始扫描后没有识别结果

**解决方案**:
1. 检查是否授予了屏幕录制权限
2. 在系统设置中确认应用已被勾选
3. 重启应用
4. 检查控制台日志是否有错误信息

### 问题 4: OCR 识别不准确

**症状**: 识别到的文字不正确或不完整

**解决方案**:
1. 增加扫描间隔（如改为 2 秒）
2. 确保屏幕文字清晰可见
3. 放大文字大小
4. 避免文字被遮挡
5. 使用更完整的查找文字

### 问题 5: 无法点击

**症状**: 找到文字但无法点击

**解决方案**:
1. 确认辅助功能权限已授予
2. 检查目标应用是否在前台
3. 尝试手动点击验证坐标是否正确
4. 查看控制台日志

---

## 📊 性能优化

### 降低 CPU 占用

1. **增加扫描间隔**: 将 OCR 扫描间隔设置为 2-3 秒
2. **及时停止扫描**: 不使用时停止 OCR 扫描
3. **关闭不必要的应用**: 减少系统负担

### 降低内存占用

1. **定期重启应用**: 长时间运行后重启
2. **避免同时运行多个功能**: 分别使用键盘输入和 OCR 功能

---

## 🔍 日志查看

### 查看应用日志

```bash
# 查看系统日志
log stream --predicate 'process == "MacWoWAuxiliary"' --level debug

# 或使用 Console.app
# 打开 Console.app → 搜索 "MacWoWAuxiliary"
```

### 常见日志信息

```
✅ 正常日志:
- "已启用防休眠模式"
- "模拟键盘 X 键输入完成"
- "OCR识别完成: X 个文字区域"
- "找到文字 'XXX' 并点击"

❌ 错误日志:
- "截屏失败"
- "OCR识别错误"
- "创建鼠标事件失败"
```

---

## 📱 系统要求

| 项目 | 要求 |
|------|------|
| **操作系统** | macOS 10.15 (Catalina) 或更高 |
| **内存** | 至少 4GB RAM |
| **存储空间** | 至少 50MB 可用空间 |
| **权限** | 辅助功能、屏幕录制 |

---

## 🔄 更新应用

### 更新步骤

1. 下载新版本的应用
2. 删除旧版本（可选）
3. 将新版本复制到应用程序文件夹
4. 重新授予权限（如果需要）
5. 重启应用

### 保留设置

应用的设置会自动保存，更新后无需重新配置。

---

## 🗑️ 卸载应用

### 完全卸载步骤

1. **删除应用**:
   ```bash
   rm -rf /Applications/MacWoWAuxiliary.app
   # 或
   rm -rf ~/Desktop/MacWoWAuxiliary.app
   ```

2. **移除权限**:
   - 系统设置 → 隐私与安全性 → 辅助功能 → 移除应用
   - 系统设置 → 隐私与安全性 → 屏幕录制 → 取消勾选

3. **清理偏好设置**（可选）:
   ```bash
   rm -rf ~/Library/Preferences/com.star.MacWoWAuxiliary.plist
   rm -rf ~/Library/Application\ Support/MacWoWAuxiliary
   ```

---

## 💡 使用技巧

### 技巧 1: 组合使用功能

可以同时使用键盘输入和 OCR 功能：
1. 使用 OCR 找到并点击按钮
2. 使用键盘输入填写表单

### 技巧 2: 创建快捷方式

将应用添加到 Dock 或启动台，方便快速访问。

### 技巧 3: 使用菜单栏

应用运行时会在菜单栏显示图标，可以快速控制：
- 开始/停止定时器
- 退出应用

---

## 📞 获取帮助

如果遇到问题，请查看：

1. **[快速开始指南](QUICK_START.md)** - 基本使用方法
2. **[OCR 功能说明](OCR_README.md)** - 详细功能文档
3. **[使用示例](OCRUsageExample.swift)** - 代码示例
4. **[权限配置](PrivacyInfo.md)** - 权限详解

---

**安装完成！开始使用吧！** 🎉
