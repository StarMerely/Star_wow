# OCR 简化 UI 说明

## 🎯 设计理念

**一键开始，一键停止**

简化操作流程，只需：
1. 输入文字 **或** 选择图片
2. 点击 ▶️ 开始
3. 自动循环查找并点击
4. 点击 ⏸ 停止

---

## ✨ 新 UI 特点

### 1. **统一的开始/停止按钮**

**之前**:
```
🔍 查找并点击  |  🔄 循环查找
```

**现在**:
```
▶️ 开始  (绿色)
⏸ 停止  (红色)
```

### 2. **支持两种输入模式**

#### 模式 1: 文字模式
```
1. 在 "查找文字" 输入框输入文字
2. 点击 ▶️ 开始
3. 自动循环识别屏幕并点击
```

#### 模式 2: 图片模式
```
1. 点击 🖼️ 识别图片
2. 选择图片文件
3. 点击 ▶️ 开始
4. 自动循环识别图片并点击
```

---

## 📊 完整工作流程

### 场景 1: 屏幕文字循环点击

```
┌─────────────────────────────────────┐
│ 查找文字: [领取]                     │
│                                      │
│ 循环间隔: [3] 秒                     │
│                                      │
│ [▶️ 开始]                            │
└─────────────────────────────────────┘

点击 ▶️ 开始 后：
→ 每 3 秒识别一次屏幕
→ 查找 "领取" 文字
→ 找到后自动点击
→ 继续循环
→ 点击 ⏸ 停止 结束
```

### 场景 2: 图片文字循环点击

```
┌─────────────────────────────────────┐
│ 查找文字: [确定]                     │
│                                      │
│ [🖼️ 识别图片]                        │
│ 📸 screenshot.png                    │
│                                      │
│ [▶️ 开始]                            │
└─────────────────────────────────────┘

点击 ▶️ 开始 后：
→ 每次循环识别选择的图片
→ 查找 "确定" 文字
→ 找到后自动点击
→ 继续循环
→ 点击 ⏸ 停止 结束
```

### 场景 3: 多个文字依次点击

```
┌─────────────────────────────────────┐
│ 查找文字: [领取;确定;继续]           │
│                                      │
│ 点击延迟: [0.5] 秒                   │
│                                      │
│ [▶️ 开始]                            │
└─────────────────────────────────────┘

点击 ▶️ 开始 后：
→ 识别屏幕
→ 查找 "领取" → 点击 → 等待 0.5 秒
→ 查找 "确定" → 点击 → 等待 0.5 秒
→ 查找 "继续" → 点击
→ 继续循环
```

---

## 🎮 按钮说明

### 主要按钮

#### ▶️ 开始 (绿色)
- **功能**: 开始循环查找并点击
- **启用条件**: 
  - 输入了文字 **或** 选择了图片
- **行为**:
  - 文字模式: 循环识别屏幕
  - 图片模式: 循环识别图片
  - 找到文字后自动点击
  - 持续循环直到手动停止

#### ⏸ 停止 (红色)
- **功能**: 停止循环
- **行为**:
  - 停止定时器
  - 停止扫描
  - 还原 Base64 编码的文字
  - 显示停止消息

---

### 辅助按钮

#### 🖼️ 识别图片
- **功能**: 选择要识别的图片文件
- **支持格式**: PNG, JPEG, HEIC, TIFF, BMP
- **行为**:
  - 打开文件选择对话框
  - 选择图片后显示文件名
  - 点击开始后循环识别该图片

#### 🗑️ 清除
- **功能**: 清除所有输入和结果
- **清除内容**:
  - 查找文字
  - 选择的图片
  - 结果消息

#### 🔄 重置
- **功能**: 重置所有设置
- **重置内容**:
  - 循环间隔 → 1 秒
  - 点击延迟 → 0.5 秒
  - 查找文字 → 清空
  - 选择的图片 → 清空
  - 结果消息 → 清空

#### 📂 打开截图
- **功能**: 在 Finder 中打开截图目录
- **路径**: `~/Documents/tmp/`

---

## 💡 使用技巧

### 1. 文字输入技巧

**单个文字**:
```
领取
```

**多个文字（用分号分隔）**:
```
领取;确定;继续
```

**Base64 保护**:
- 开始后，输入框自动显示 Base64 编码
- 防止运行中误修改
- 停止后自动还原原始文字

### 2. 图片模式技巧

**选择图片**:
```
1. 点击 🖼️ 识别图片
2. 选择包含文字的图片
3. 看到 📸 图片名称
4. 点击 ▶️ 开始
```

**图片来源**:
- ✅ 之前保存的截图
- ✅ 游戏截图
- ✅ 网页截图
- ✅ 任何包含文字的图片

**优势**:
- 不需要实时截屏
- 可以反复识别同一张图片
- 适合固定场景的自动化

### 3. 循环间隔设置

**推荐值**:
- **快速响应**: 1-2 秒
- **正常使用**: 3-5 秒
- **省资源**: 5-10 秒

**注意**:
- 间隔太短会占用更多 CPU
- 间隔太长可能错过时机

### 4. 点击延迟设置

**推荐值**:
- **快速点击**: 0.3-0.5 秒
- **正常点击**: 0.5-1 秒
- **慢速点击**: 1-2 秒

**用途**:
- 多个文字依次点击时的间隔
- 给界面响应留出时间

---

## 🔄 状态显示

### 运行前
```
查找文字: [领取]
循环间隔: [3] 秒

[▶️ 开始]
```

### 运行中
```
查找文字: [6aKG5Y+W]  ← Base64 编码
循环间隔: [3] 秒

[⏸ 停止]  ← 红色

🟢 扫描中...
▶️ 开始循环 [6aKG5Y+W] - 屏幕模式，间隔 3 秒
```

### 找到并点击
```
[⏸ 停止]  ← 红色

🟢 扫描中...
✅ 已点击 [6aKG5Y+W]，继续循环中...
```

### 停止后
```
查找文字: [领取]  ← 自动还原
循环间隔: [3] 秒

[▶️ 开始]  ← 绿色

⏸ 已停止
```

---

## 📊 模式对比

| 特性 | 文字模式 | 图片模式 |
|------|---------|---------|
| **输入方式** | 输入框输入 | 选择图片文件 |
| **识别对象** | 实时屏幕 | 指定图片 |
| **适用场景** | 动态界面 | 固定界面 |
| **响应速度** | 实时 | 实时 |
| **资源占用** | 中等 | 较低 |

---

## 🎯 实际应用

### 应用 1: 游戏任务自动领取

```
1. 输入文字: "领取"
2. 循环间隔: 3 秒
3. 点击 ▶️ 开始
4. 游戏中出现 "领取" 按钮时自动点击
5. 完成后点击 ⏸ 停止
```

### 应用 2: 对话框自动确认

```
1. 输入文字: "确定;关闭"
2. 循环间隔: 2 秒
3. 点击延迟: 0.5 秒
4. 点击 ▶️ 开始
5. 自动点击所有确定和关闭按钮
```

### 应用 3: 固定界面循环操作

```
1. 截取游戏界面保存为图片
2. 点击 🖼️ 识别图片，选择该图片
3. 输入文字: "开始战斗"
4. 循环间隔: 5 秒
5. 点击 ▶️ 开始
6. 自动识别图片并点击
```

---

## ⚙️ 技术实现

### 按钮状态管理

```swift
Button(ocrManager.isScanning ? "⏸ 停止" : "▶️ 开始") {
    // 检查输入
    let hasInput = !searchText.isEmpty || !selectedImagePath.isEmpty
    
    if hasInput {
        if ocrManager.isScanning {
            // 停止逻辑
        } else {
            // 开始逻辑
        }
    }
}
.buttonStyle(.borderedProminent)
.tint(ocrManager.isScanning ? .red : .green)
.disabled(searchText.isEmpty && selectedImagePath.isEmpty)
```

### 模式检测

```swift
// 开始时检测模式
if !selectedImagePath.isEmpty {
    // 图片模式：先识别图片
    manager.performOCROnImage(at: selectedImagePath)
}

// 显示模式信息
let source = selectedImagePath.isEmpty ? "屏幕" : "图片"
clickResultMessage = "▶️ 开始循环 - \(source)模式"
```

### Base64 保护

```swift
// 开始时编码
savedSearchTextBase64 = encodeToBase64(searchText)
searchText = savedSearchTextBase64  // UI 显示编码

// 停止时还原
if !savedSearchTextBase64.isEmpty {
    searchText = decodeFromBase64(savedSearchTextBase64)
    savedSearchTextBase64 = ""
}
```

---

## 📝 注意事项

### 1. 输入要求

- ✅ 至少输入文字或选择图片之一
- ✅ 文字和图片可以同时使用
- ❌ 两者都为空时按钮禁用

### 2. 运行中修改

- ⚠️ 运行中输入框显示 Base64 编码
- ⚠️ 不要在运行中修改输入框
- ✅ 需要修改请先停止

### 3. 图片选择

- ✅ 选择后显示文件名
- ✅ 可以重新选择覆盖
- ✅ 清除按钮会清除选择

### 4. 性能建议

- 文字模式: 循环间隔 ≥ 2 秒
- 图片模式: 循环间隔 ≥ 1 秒
- 多个文字: 点击延迟 ≥ 0.5 秒

---

## ✅ 优势总结

### 1. **操作简化**
- 只需一个开始按钮
- 自动判断模式
- 一键停止

### 2. **功能强大**
- 支持文字和图片两种模式
- 支持多个文字依次点击
- 支持循环执行

### 3. **安全可靠**
- Base64 保护输入
- 清晰的状态显示
- 随时可以停止

### 4. **灵活易用**
- 适应不同场景
- 参数可调整
- 结果可查看

---

**现在 OCR 功能更简单易用了！只需输入文字或选择图片，点击开始即可自动循环查找并点击！** 🎉
